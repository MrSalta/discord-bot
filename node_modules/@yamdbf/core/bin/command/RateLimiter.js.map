{"version":3,"sources":["command/RateLimiter.ts"],"names":[],"mappings":";;AAAA,2CAA8C;AAC9C,2CAAwC;AACxC,uCAAoC;AAGpC;;;;;GAKG;AACH;IAMC,YAAmB,KAAa,EAAE,MAAe;QAEhD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QAEtB,IAAI,CAAC,WAAW,GAAG,IAAI,uBAAU,EAAyC,CAAC;QAC3E,IAAI,CAAC,aAAa,GAAG,IAAI,uBAAU,EAAqB,CAAC;IAC1D,CAAC;IAED;;;;;;;;OAQG;IACI,GAAG,CAAC,OAAgB,EAAE,YAAmB;QAE/C,MAAM,IAAI,GAAS,YAAY,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;QAChE,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAC3B;YACC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;gBACnC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,qBAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YAC7D,OAAO,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SACvC;aAED;YACC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;gBAC1C,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,uBAAU,EAAqB,CAAC,CAAC;YAE7E,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;gBACvD,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,qBAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YAEjF,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SAC3D;IACF,CAAC;IAED;;;OAGG;IACK,WAAW,CAAC,WAAmB;QAEtC,MAAM,UAAU,GAAW,0BAA0B,CAAC;QACtD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC;YAAE,MAAM,IAAI,KAAK,CAAC,qCAAqC,WAAW,GAAG,CAAC,CAAC;QACxG,IAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAwB,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAE5F,IAAI,IAAI;YAAE,QAAQ,GAAG,WAAI,CAAC,cAAc,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;;YACrD,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACnC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;QAExB,OAAO,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;IAC1B,CAAC;IAED;;;OAGG;IACK,SAAS,CAAC,OAAiB;QAElC,OAAO,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,KAAK,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;IACjF,CAAC;CACD;AAtED,kCAsEC","file":"RateLimiter.js","sourcesContent":["import { Collection, User } from 'discord.js';\nimport { RateLimit } from './RateLimit';\nimport { Time } from '../util/Time';\nimport { Message } from '../types/Message';\n\n/**\n * Handles assigning ratelimits to guildmembers and users\n * @param {string} limit Ratelimit string matching the regex `\\d+\\/\\d+[s|m|h|d]`<br>\n * \t\t\t\t\t\t **Example:** `1/10m` to limit a command to one use per 10 minutes\n * @param {boolean} global Whether or not this RateLimiter handles global ratelimits\n */\nexport class RateLimiter\n{\n\tprivate readonly _limit: [number, number];\n\tprivate readonly _global: boolean;\n\tprivate readonly _rateLimits: Collection<string, Collection<string, RateLimit>>;\n\tprivate readonly _globalLimits: Collection<string, RateLimit>;\n\tpublic constructor(limit: string, global: boolean)\n\t{\n\t\tthis._limit = this._parseLimit(limit);\n\t\tthis._global = global;\n\n\t\tthis._rateLimits = new Collection<string, Collection<string, RateLimit>>();\n\t\tthis._globalLimits = new Collection<string, RateLimit>();\n\t}\n\n\t/**\n\t * Returns the RateLimit object for the message author if global\n\t * or message member if message is in a guild. If a userOverride\n\t * is given then the RateLimit or global RateLimit will be\n\t * retrieved for that user based on the message location\n\t * @param {external:Message} message Discord.js Message object\n\t * @param {external:User} userOverride User object to use in place of Message author\n\t * @returns {RateLimit}\n\t */\n\tpublic get(message: Message, userOverride?: User): RateLimit\n\t{\n\t\tconst user: User = userOverride ? userOverride : message.author;\n\t\tif (this._isGlobal(message))\n\t\t{\n\t\t\tif (!this._globalLimits.has(user.id))\n\t\t\t\tthis._globalLimits.set(user.id, new RateLimit(this._limit));\n\t\t\treturn this._globalLimits.get(user.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this._rateLimits.has(message.guild.id))\n\t\t\t\tthis._rateLimits.set(message.guild.id, new Collection<string, RateLimit>());\n\n\t\t\tif (!this._rateLimits.get(message.guild.id).has(user.id))\n\t\t\t\tthis._rateLimits.get(message.guild.id).set(user.id, new RateLimit(this._limit));\n\n\t\t\treturn this._rateLimits.get(message.guild.id).get(user.id);\n\t\t}\n\t}\n\n\t/**\n\t * Parse the ratelimit from the given input string\n\t * @private\n\t */\n\tprivate _parseLimit(limitString: string): [number, number]\n\t{\n\t\tconst limitRegex: RegExp = /^(\\d+)\\/(\\d+)(s|m|h|d)?$/;\n\t\tif (!limitRegex.test(limitString)) throw new Error(`Failed to parse a ratelimit from '${limitString}'`);\n\t\tlet [limit, duration, post]: (string | number)[] = limitRegex.exec(limitString).slice(1, 4);\n\n\t\tif (post) duration = Time.parseShorthand(duration + post);\n\t\telse duration = parseInt(duration);\n\t\tlimit = parseInt(limit);\n\n\t\treturn [limit, duration];\n\t}\n\n\t/**\n\t * Determine whether or not to use the global rate limit collection\n\t * @private\n\t */\n\tprivate _isGlobal(message?: Message): boolean\n\t{\n\t\treturn message ? message.channel.type !== 'text' || this._global : this._global;\n\t}\n}\n"],"sourceRoot":"../../src"}