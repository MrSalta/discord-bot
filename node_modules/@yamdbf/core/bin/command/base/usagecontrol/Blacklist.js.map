{"version":3,"sources":["command/base/usagecontrol/Blacklist.ts"],"names":[],"mappings":"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","file":"Blacklist.js","sourcesContent":["import { Message } from '../../../types/Message';\nimport { Command } from '../../Command';\nimport { Middleware } from '../../middleware/Middleware';\nimport { User, GuildMember } from 'discord.js';\nimport { using, localizable } from '../../CommandDecorators';\nimport { ResourceLoader } from '../../../types/ResourceLoader';\nimport { BaseStrings as s } from '../../../localization/BaseStrings';\n\nexport default class extends Command\n{\n\tpublic constructor()\n\t{\n\t\tsuper({\n\t\t\tname: 'blacklist',\n\t\t\tdesc: 'Blacklist a user from calling commands',\n\t\t\taliases: ['bl'],\n\t\t\tusage: `<prefix>blacklist <action> <user> ['global']`,\n\t\t\tinfo: 'If global, this will block the user from calling commands in ANY server and DMs',\n\t\t\tcallerPermissions: ['ADMINISTRATOR']\n\t\t});\n\t}\n\n\t@using(Middleware.resolve('action: String, user: User'))\n\t@using(Middleware.expect(`action: ['add', 'remove'], user: User`))\n\t@localizable\n\tpublic async action(message: Message, [res, action, user, global]: [ResourceLoader, string, User, string]): Promise<Message | Message[]>\n\t{\n\t\tif (action === 'add')\n\t\t{\n\t\t\tif (user.id === message.author.id)\n\t\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_ERR_NOSELF));\n\n\t\t\tif (user.bot) return message.channel.send(res(s.CMD_BLACKLIST_ERR_NOBOT));\n\n\t\t\tif (global === 'global')\n\t\t\t{\n\t\t\t\tif (!this.client.isOwner(message.author))\n\t\t\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_ERR_OWNERONLY));\n\n\t\t\t\tconst globalBlacklist: any = await this.client.storage.get('blacklist') || {};\n\t\t\t\tif (globalBlacklist[user.id])\n\t\t\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_ERR_ALREADYGLOBAL));\n\n\t\t\t\tawait this.client.storage.set(`blacklist.${user.id}`, true);\n\t\t\t\tthis.client.emit('blacklistAdd', user, true);\n\t\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_GLOBALSUCCESS, { user: user.tag }));\n\t\t\t}\n\n\t\t\tlet member: GuildMember;\n\t\t\ttry { member = await message.guild.fetchMember(user); }\n\t\t\tcatch (err) {}\n\n\t\t\tif (member && member.permissions.has('ADMINISTRATOR'))\n\t\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_ERR_BADTARGET));\n\n\t\t\tconst guildBlacklist: any = await message.guild.storage.settings.get('blacklist') || {};\n\t\t\tif (guildBlacklist[user.id])\n\t\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_ERR_ALREADYBLACKLISTED));\n\n\t\t\tawait message.guild.storage.settings.set(`blacklist.${user.id}`, true);\n\t\t\tthis.client.emit('blacklistAdd', user, false);\n\t\t\treturn message.channel.send(res(s.CMD_BLACKLIST_SUCCESS, { user: user.tag }));\n\t\t}\n\t\telse if (action === 'remove')\n\t\t{\n\t\t\tif (global === 'global')\n\t\t\t{\n\t\t\t\tif (!this.client.isOwner(message.author))\n\t\t\t\t\treturn message.channel.send(res(s.CMD_WHITELIST_ERR_OWNERONLY));\n\n\t\t\t\tconst globalBlacklist: any = await this.client.storage.get('blacklist') || {};\n\t\t\t\tif (!globalBlacklist[user.id])\n\t\t\t\t\treturn message.channel.send(res(s.CMD_WHITELIST_ERR_NOTGLOBAL));\n\n\t\t\t\tawait this.client.storage.remove(`blacklist.${user.id}`);\n\t\t\t\tthis.client.emit('blacklistRemove', user, true);\n\t\t\t\treturn message.channel.send(res(s.CMD_WHITELIST_GLOBALSUCCESS, { user: user.tag }));\n\t\t\t}\n\n\t\t\tconst guildBlacklist: any = await message.guild.storage.settings.get('blacklist') || {};\n\t\t\tif (!guildBlacklist[user.id])\n\t\t\t\treturn message.channel.send(res(s.CMD_WHITELIST_ERR_NOTBLACKLISTED));\n\n\t\t\tawait message.guild.storage.settings.remove(`blacklist.${user.id}`);\n\t\t\tthis.client.emit('blacklistRemove', user, false);\n\t\t\treturn message.channel.send(res(s.CMD_WHITELIST_SUCCESS, { user: user.tag }));\n\t\t}\n\t}\n}\n"],"sourceRoot":"../../../../src"}