{"version":3,"sources":["command/middleware/Expect.ts"],"names":[],"mappings":"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","file":"Expect.js","sourcesContent":["import { MiddlewareFunction } from '../../types/MiddlewareFunction';\nimport { ExpectArgType } from '../../types/ExpectArgType';\nimport { Message } from '../../types/Message';\nimport { Command } from '../Command';\nimport { Lang } from '../../localization/Lang';\nimport { Util } from '../../util/Util';\nimport { ResourceLoader } from '../../types/ResourceLoader';\nimport { BaseStrings as s } from '../../localization/BaseStrings';\nimport { GuildMember, Role, TextChannel, User } from 'discord.js';\n\nexport type MappedExpectArgType = { [name: string]: ExpectArgType };\n\nexport function expect(argTypes: string | MappedExpectArgType): MiddlewareFunction\n{\n\tif (typeof argTypes === 'string') argTypes =\n\t\t<MappedExpectArgType> Util.parseArgTypes(argTypes);\n\n\tconst names: string[] = Object.keys(argTypes);\n\tconst types: ExpectArgType[] = names\n\t\t.map(name => (<MappedExpectArgType> argTypes)[name]);\n\n\treturn async function(this: Command, message: Message, args: any[]): Promise<[Message, any[]]>\n\t{\n\t\tconst dm: boolean = message.channel.type !== 'text';\n\n\t\tconst lang: string = dm\n\t\t\t? this.client.defaultLang\n\t\t\t: await message.guild.storage.settings.get('lang')\n\t\t\t\t|| this.client.defaultLang;\n\t\tconst res: ResourceLoader = Lang.createResourceLoader(lang);\n\n\t\tconst prefix: string = !dm ? await message.guild.storage.settings.get('prefix') : '';\n\t\tconst usage: string = Lang.getCommandInfo(this, lang).usage.replace('<prefix>', prefix);\n\n\t\tfor (const [index, name] of names.entries())\n\t\t{\n\t\t\tconst arg: any = args[index];\n\t\t\tconst type: ExpectArgType = types[index];\n\n\t\t\tif (dm && !(type instanceof Array)\n\t\t\t\t&& !['String', 'Number', 'User', 'Any'].includes(<string> type))\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`in arg \\`${name}\\`: Type \\`${type}\\` is not usable within DM-capable commands.`);\n\n\t\t\tif (typeof arg === 'undefined' || arg === null)\n\t\t\t\tthrow new Error(res(s.EXPECT_ERR_MISSING_VALUE, {\n\t\t\t\t\ttype: type instanceof Array ? type.map(t => `\\`${t}\\``).join(', ') : `\\`${type}\\``,\n\t\t\t\t\tname,\n\t\t\t\t\tusage\n\t\t\t\t}));\n\n\t\t\tif (type === 'Any') continue;\n\n\t\t\tif (type instanceof Array)\n\t\t\t{\n\t\t\t\tif (!type.map(a => a.toLowerCase()).includes(arg.toLowerCase()))\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_INVALID_OPTION,\n\t\t\t\t\t\t{ type: type.map(t => `\\`${t}\\``).join(', '), name, arg, usage }));\n\t\t\t}\n\t\t\telse if (type === 'String')\n\t\t\t{\n\t\t\t\tif (typeof arg !== 'string')\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_EXPECTED_TYPE,\n\t\t\t\t\t\t{ name, expected: 'String', type: arg.constructor.name }));\n\t\t\t}\n\t\t\telse if (type === 'Number')\n\t\t\t{\n\t\t\t\tif (typeof arg !== 'number' || (!isNaN(arg) && !isFinite(arg)))\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_EXPECTED_TYPE,\n\t\t\t\t\t\t{ name, expected: 'Number', type: arg === Infinity ? 'Infinity' : arg.constructor.name }));\n\t\t\t}\n\t\t\telse if (type === 'User')\n\t\t\t{\n\t\t\t\tif (!(arg instanceof User))\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_EXPECTED_TYPE,\n\t\t\t\t\t\t{ name, expected: 'User', type: arg.constructor.name }));\n\t\t\t}\n\t\t\telse if (type === 'Member')\n\t\t\t{\n\t\t\t\tif (!(arg instanceof GuildMember))\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_EXPECTED_TYPE,\n\t\t\t\t\t\t{ name, expected: 'GuildMember', type: arg.constructor.name }));\n\t\t\t}\n\t\t\telse if (type === 'Channel')\n\t\t\t{\n\t\t\t\tif (!(arg instanceof TextChannel))\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_EXPECTED_TYPE,\n\t\t\t\t\t\t{ name, expected: 'TextChannel', type: arg.constructor.name }));\n\t\t\t}\n\t\t\telse if (type === 'Role')\n\t\t\t{\n\t\t\t\tif (!(arg instanceof Role))\n\t\t\t\t\tthrow new Error(res(s.EXPECT_ERR_EXPECTED_TYPE,\n\t\t\t\t\t\t{ name, expected: 'Role', type: arg.constructor.name }));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthrow new Error(`in arg \\`${name}\\`: Type \\`${type}\\` is not a valid argument type.`);\n\t\t\t}\n\t\t}\n\n\t\treturn [message, args];\n\t};\n}\n"],"sourceRoot":"../../../src"}