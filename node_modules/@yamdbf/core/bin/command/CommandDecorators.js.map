{"version":3,"sources":["command/CommandDecorators.ts"],"names":[],"mappings":"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","file":"CommandDecorators.js","sourcesContent":["import { Lang } from '../localization/Lang';\nimport { ArgOpts } from '../types/ArgOpts';\nimport { Message } from '../types/Message';\nimport { MiddlewareFunction } from '../types/MiddlewareFunction';\nimport { ResourceLoader } from '../types/ResourceLoader';\nimport { Command } from './Command';\nimport { RateLimiter } from './RateLimiter';\nimport { PermissionResolvable } from 'discord.js';\n\n/**\n * Grouping of static decorator methods for the {@link Command}\n * class and {@link Command#action} method\n *\n * >**Note:** This is a TypeScript feature. JavaScript users are limited to\n * using CommandInfo to define their commands and {@link Command#use} for\n * assigning middleware functions to commands\n * @module CommandDecorators\n */\n\n/**\n * Apply a middleware function to the action method of a Command.\n * Identical to {@link Command#use} but used as a Command action\n * method decorator\n * @static\n * @method using\n * @param {MiddlewareFunction} func Middleware function to use\n * \t\t\t\t\t\t\t\t\tfor the decorated Command action\n * @returns {MethodDecorator}\n */\nexport function using(func: MiddlewareFunction): MethodDecorator\n{\n\treturn function(target: Command, key: string, descriptor: PropertyDescriptor): PropertyDescriptor\n\t{\n\t\tif (!target) throw new Error('@using must be used as a method decorator for a Command action method.');\n\t\tif (key !== 'action') throw new Error(\n\t\t\t`\"${target.constructor.name}#${key}\" is not a valid method target for @using.`);\n\n\t\tif (!descriptor) descriptor = Object.getOwnPropertyDescriptor(target, key);\n\t\tconst original: any = descriptor.value;\n\t\tdescriptor.value = async function(this: Command, message: Message, args: any[]): Promise<any>\n\t\t{\n\t\t\tlet middlewarePassed: boolean = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet result: Promise<[Message, any[]]> | [Message, any[]] =\n\t\t\t\t\tfunc.call(this, message, args);\n\t\t\t\tif (result instanceof Promise) result = await result;\n\t\t\t\tif (!(result instanceof Array))\n\t\t\t\t{\n\t\t\t\t\tif (typeof result === 'string') message.channel.send(result);\n\t\t\t\t\tmiddlewarePassed = false;\n\t\t\t\t}\n\t\t\t\tif (middlewarePassed) [message, args] = result;\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tmiddlewarePassed = false;\n\t\t\t\tmessage.channel.send(err.toString(), { split: true });\n\t\t\t}\n\t\t\tif (middlewarePassed) return await original.apply(this, [message, args]);\n\t\t};\n\t\treturn descriptor;\n\t};\n}\n\n/**\n * Creates a {@link ResourceLoader} function using the localization\n * language for the command call and passes it as the first argument\n * for that command call.\n *\n * Identical to [localize]{@link module:Middleware.localize} but used\n * as a Command action method decorator.\n *\n * Like the `localize` middleware, you will want to use this after\n * any other usages of middleware via [@using()]{@link module:CommandDecorators.using}.\n * Middleware added via {@link Command#use} is evaluated before\n * middleware added via `@using()`.\n * @static\n * @name localizable\n * @type {MethodDecorator}\n */\nexport function localizable(target: Command, key: string, descriptor: PropertyDescriptor): PropertyDescriptor\n{\n\tif (!target) throw new Error('@localizable must be used as a method decorator for a Command action method.');\n\tif (key !== 'action') throw new Error(\n\t\t`\"${target.constructor.name}#${key}\" is not a valid method target for @localizable.`);\n\n\tif (!descriptor) descriptor = Object.getOwnPropertyDescriptor(target, key);\n\tconst original: any = descriptor.value;\n\tdescriptor.value = async function(this: Command, message: Message, args: any[]): Promise<any>\n\t{\n\t\tconst dm: boolean = message.channel.type !== 'text';\n\t\tconst lang: string = dm ? this.client.defaultLang\n\t\t\t: await message.guild.storage.settings.get('lang')\n\t\t\t\t|| this.client.defaultLang;\n\n\t\tconst res: ResourceLoader = Lang.createResourceLoader(lang);\n\t\treturn await original.apply(this, [message, [res, ...args]]);\n\t};\n\treturn descriptor;\n}\n\n/**\n * Set `name` metadata\n * @static\n * @method name\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function name(value: string): ClassDecorator\n{\n\treturn _setMetaData('name', value);\n}\n\n/**\n * Set `aliases` metadata\n * @static\n * @method aliases\n * @param {...string} values Values to set\n * @returns {ClassDecorator}\n */\nexport function aliases(...values: string[]): ClassDecorator\n{\n\treturn _setMetaData('aliases', values);\n}\n\n/**\n * Set `desc` metadata\n * @static\n * @method desc\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function desc(value: string): ClassDecorator\n{\n\treturn _setMetaData('desc', value);\n}\n\n/**\n * Set `usage` metadata\n * @static\n * @method usage\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function usage(value: string): ClassDecorator\n{\n\treturn _setMetaData('usage', value);\n}\n\n/**\n * Set `info` metadata\n * @static\n * @method info\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function info(value: string): ClassDecorator\n{\n\treturn _setMetaData('info', value);\n}\n\n/**\n * Set `group` metadata\n * @static\n * @method group\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function group(value: string): ClassDecorator\n{\n\treturn _setMetaData('group', value);\n}\n\n/**\n * Set `argOpts` metadata\n * @static\n * @method argOpts\n * @param {ArgOpts} value Value to set\n * @returns {ClassDecorator}\n */\nexport function argOpts(value: ArgOpts): ClassDecorator\n{\n\treturn _setMetaData('usage', value);\n}\n\n/**\n * Set `callerPermissions` metadata\n * @static\n * @method callerPermissions\n * @param {...external:PermissionResolvable} values Values to set\n * @returns {ClassDecorator}\n */\nexport function callerPermissions(...values: PermissionResolvable[]): ClassDecorator\n{\n\treturn _setMetaData('callerPermissions', values);\n}\n\n/**\n * Set `clientPermissions` metadata\n * @static\n * @method clientPermissions\n * @param {...external:PermissionResolvable} values Values to set\n * @returns {ClassDecorator}\n */\nexport function clientPermissions(...values: PermissionResolvable[]): ClassDecorator\n{\n\treturn _setMetaData('clientPermissions', values);\n}\n\n/**\n * Set `roles` metadata\n * @static\n * @method roles\n * @param {...string} values Values to set\n * @returns {ClassDecorator}\n */\nexport function roles(...values: string[]): ClassDecorator\n{\n\treturn _setMetaData('roles', values);\n}\n\n/**\n * Set `ratelimit` metadata\n * @static\n * @method ratelimit\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function ratelimit(value: string): ClassDecorator\n{\n\treturn _setMetaData('_rateLimiter', new RateLimiter(value, false));\n}\n\n/**\n * Set `overloads` metadata\n * @static\n * @method overloads\n * @param {string} value Value to set\n * @returns {ClassDecorator}\n */\nexport function overloads(value: string): ClassDecorator\n{\n\treturn _setMetaData('overloads', value);\n}\n\n/**\n * Set `owneronly` flag metadata\n * @static\n * @name ownerOnly\n * @type {ClassDecorator}\n */\nexport function ownerOnly<T extends Function>(target: T): T\n{\n\treturn _setFlagMetaData(target, 'ownerOnly');\n}\n\n/**\n * Set `guildOnly` flag metadata\n * @static\n * @name guildOnly\n * @type {ClassDecorator}\n */\nexport function guildOnly<T extends Function>(target: T): T\n{\n\treturn _setFlagMetaData(target, 'guildOnly');\n}\n\n/**\n * Set `hidden` flag metadata\n * @static\n * @name hidden\n * @type {ClassDecorator}\n */\nexport function hidden<T extends Function>(target: T): T\n{\n\treturn _setFlagMetaData(target, 'hidden');\n}\n\n/**\n * Set a boolean flag metadata on a command class\n * @private\n */\nfunction _setFlagMetaData<T extends Function>(target: T, flag: string): T\n{\n\tObject.defineProperty(target.prototype, flag, {\n\t\tvalue: true,\n\t\tenumerable: true,\n\t});\n\treturn target;\n}\n\n/**\n * Set an arbitrary value to an arbitrary key on a command class\n * @private\n */\nfunction _setMetaData(key: string, value: any): ClassDecorator\n{\n\treturn function<T extends Function>(target: T): T\n\t{\n\t\tObject.defineProperty(target.prototype, key, {\n\t\t\tvalue: value,\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t\twritable: true\n\t\t});\n\t\treturn target;\n\t};\n}\n"],"sourceRoot":"../../src"}