{"version":3,"sources":["localization/Lang.ts"],"names":[],"mappings":"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","file":"Lang.js","sourcesContent":["import { Client } from '../client/Client';\nimport { Command } from '../command/Command';\nimport { LocalizedCommandInfo } from '../types/LocalizedCommandInfo';\nimport { ResourceLoader } from '../types/ResourceLoader';\nimport { TemplateData } from '../types/TemplateData';\nimport { Logger, logger } from '../util/logger/Logger';\nimport { LangFileParser } from './LangFileParser';\nimport { Language } from './Language';\nimport { Util } from '../util/Util';\nimport * as fs from 'fs';\nimport * as glob from 'glob';\nimport * as path from 'path';\n\n/**\n * Module providing localization support throughout the framework.\n * Allows client output to be translated to other languages\n * @module Lang\n */\nexport class Lang\n{\n\t@logger private static logger: Logger;\n\tprivate static _instance: Lang;\n\tprivate client: Client;\n\tprivate commandInfo: { [command: string]: { [lang: string]: LocalizedCommandInfo } };\n\tprivate langs: { [lang: string]: Language };\n\tprivate meta: { [lang: string]: { [key: string]: any } };\n\tprivate constructor(client: Client)\n\t{\n\t\tif (Lang._instance)\n\t\t\tthrow new Error('Cannot create multiple instances of Lang singleton. Use Lang.createInstance() instead');\n\n\t\tthis.client = client;\n\t\tthis.commandInfo = {};\n\t\tthis.langs = {};\n\t\tthis.meta = {};\n\t}\n\n\t/**\n\t * Contains all loaded languages and their strings.\n\t * This does not include localized command helptext.\n\t * Rather than using this directly, loading stings with\n\t * a {@link ResourceLoader} function is preferred\n\t * @static\n\t * @name langs\n\t * @type {object}\n\t */\n\tpublic static get langs(): { [lang: string]: Language }\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\t\treturn Lang._instance.langs;\n\t}\n\n\t/**\n\t * Contains all available localization languages\n\t * @static\n\t * @name langNames\n\t * @type {string[]}\n\t */\n\tpublic static get langNames(): string[]\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\n\t\tlet langs: Set<string> = new Set();\n\t\tfor (const commandName of Object.keys(Lang._instance.commandInfo))\n\t\t\tfor (const lang of Object.keys(Lang._instance.commandInfo[commandName]))\n\t\t\t\tlangs.add(lang);\n\n\t\tfor (const lang of Object.keys(Lang.langs)) langs.add(lang);\n\n\t\treturn Array.from(langs);\n\t}\n\n\t/**\n\t * Create the singleton instance.\n\t * Called automatically by the YAMDBF Client at startup\n\t * @static\n\t * @method createInstance\n\t * @param {Client} client YAMDBF Client instance\n\t * @returns {void}\n\t */\n\tpublic static createInstance(client: Client): void\n\t{\n\t\tif (!Lang._instance) Lang._instance = new Lang(client);\n\t}\n\n\t/**\n\t * Set a metadata key/value for a given language\n\t * @static\n\t * @method setMetaValue\n\t * @param {string} lang Language to set metadata for\n\t * @param {string} key Metadata key to set\n\t * @param {any} value Metadata value to assign\n\t * @returns {void}\n\t */\n\tpublic static setMetaValue(lang: string, key: string, value: any): void\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\t\tUtil.assignNestedValue(Lang._instance.meta, [lang, key], value);\n\t}\n\n\t/**\n\t * Get a metadata value by key for a given language\n\t * @static\n\t * @method getMetaValue\n\t * @param {string} lang Language to get metadata for\n\t * @param {string} key Metadata key to get\n\t * @returns {any}\n\t */\n\tpublic static getMetaValue(lang: string, key: string): any\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\t\treturn Util.getNestedValue(Lang._instance.meta, [lang, key]);\n\t}\n\n\t/**\n\t * Get all metadata for a given language\n\t * @static\n\t * @method getMetadata\n\t * @param {string} lang Language to get metadata for\n\t * @returns {object}\n\t */\n\tpublic static getMetadata(lang: string): { [key: string]: any }\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\t\treturn Lang._instance.meta[lang] || {};\n\t}\n\n\t/**\n\t * To be run after loading any localizations\n\t * @private\n\t */\n\tprivate static postLoad(): void\n\t{\n\t\tif (Lang.langNames.length > 1\n\t\t\t&& (!Lang._instance.client.disableBase.includes('setlang')\n\t\t\t\t&& Lang._instance.client.commands.has('setlang')\n\t\t\t\t&& Lang._instance.client.commands.get('setlang').disabled))\n\t\t{\n\t\t\tLang._instance.client.commands.get('setlang').enable();\n\t\t\tLang.logger.info('Lang', `Additional langugage loaded, enabled 'setlang' command.`);\n\t\t}\n\t}\n\n\t/**\n\t * Load all localization files (`*.lang`) from the given directory.\n\t * This can be used to manually load custom localizations\n\t * from any given directory (when writing plugins, for instance)\n\t * @static\n\t * @method loadLocalizationsFrom\n\t * @param {string} dir Directory to load from\n\t * @returns {void}\n\t */\n\tpublic static loadLocalizationsFrom(dir: string): void\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\n\t\tconst langNameRegex: RegExp = /\\/([^\\/\\.]+)(?:\\.[^\\/]+)?\\.lang$/;\n\t\tlet langs: { [key: string]: string[] } = {};\n\t\tlet allLangFiles: string[] = [];\n\t\tdir = path.resolve(dir);\n\t\tallLangFiles.push(...glob.sync(`${dir}/**/*.lang`));\n\t\tif (allLangFiles.length === 0) throw new Error(`Failed to find any localization files in: ${dir}`);\n\n\t\tfor (const langFile of allLangFiles)\n\t\t{\n\t\t\tif (!langNameRegex.test(langFile)) continue;\n\t\t\tconst langName: string = langFile.match(langNameRegex)[1];\n\t\t\tif (!langs[langName]) langs[langName] = [];\n\t\t\tlangs[langName].push(langFile);\n\t\t}\n\n\t\tfor (const langName of Object.keys(langs))\n\t\t{\n\t\t\tfor (const langFile of langs[langName])\n\t\t\t{\n\t\t\t\tif (!langNameRegex.test(langFile)) continue;\n\t\t\t\tconst loadedLangFile: string = fs\n\t\t\t\t\t.readFileSync(langFile)\n\t\t\t\t\t.toString()\n\t\t\t\t\t.replace(/\\r\\n/g, '\\n');\n\n\t\t\t\tconst parsedLanguageFile: Language =\n\t\t\t\t\tLangFileParser.parseFile(langName, loadedLangFile);\n\n\t\t\t\tif (typeof Lang._instance.langs[langName] !== 'undefined')\n\t\t\t\t\tLang._instance.langs[langName].concat(parsedLanguageFile);\n\t\t\t\telse\n\t\t\t\t\tLang._instance.langs[langName] = parsedLanguageFile;\n\t\t\t}\n\t\t}\n\n\t\tLang.postLoad();\n\t}\n\n\t/**\n\t * Load base localization files and load localization files\n\t * from the Client's `localeDir`. Called automatically by\n\t * the YAMDBF Client at startup\n\t * @static\n\t * @method loadLocalizations\n\t * @returns {void}\n\t */\n\tpublic static loadLocalizations(): void\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\n\t\tLang.setMetaValue('en_us', 'name', 'English');\n\t\tLang.loadLocalizationsFrom(path.join(__dirname, './en_us'));\n\t\tif (Lang._instance.client.localeDir)\n\t\t\tLang.loadLocalizationsFrom(Lang._instance.client.localeDir);\n\n\t\tLang.logger.info('Lang', `Loaded string localizations for ${Object.keys(Lang.langs).length} languages.`);\n\t}\n\n\t/**\n\t * Load all command helptext localization files (`*.lang.json`)\n\t * from the given directory. This can be used to manually load\n\t * custom command helptext localizations from any given\n\t * directory (when writing plugins, for instance)\n\t * @static\n\t * @method loadCommandLocalizationsFrom\n\t * @param {string} dir Directory to load from\n\t * @returns {void}\n\t */\n\tpublic static loadCommandLocalizationsFrom(dir: string): void\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\t\tdir = path.resolve(dir);\n\t\tlet allLangFiles: string[] = [];\n\t\tallLangFiles.push(...glob.sync(`${dir}/**/*.lang.json`));\n\t\tif (allLangFiles.length === 0) return;\n\n\t\tfor (const langFile of allLangFiles)\n\t\t{\n\t\t\tlet localizations: { [command: string]: { [lang: string]: LocalizedCommandInfo } };\n\t\t\ttry { localizations = require(langFile); }\n\t\t\tcatch (err) { continue; }\n\n\t\t\tfor (const command of Object.keys(localizations))\n\t\t\t\tfor (const lang of Object.keys(localizations[command]))\n\t\t\t\t{\n\t\t\t\t\tif (typeof Util.getNestedValue(Lang._instance.commandInfo, [command, lang]) === 'undefined')\n\t\t\t\t\t\tUtil.assignNestedValue(Lang._instance.commandInfo, [command, lang], {});\n\n\t\t\t\t\tLang._instance.commandInfo[command][lang] = {\n\t\t\t\t\t\t...Lang._instance.commandInfo[command][lang],\n\t\t\t\t\t\t...localizations[command][lang]\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t}\n\n\t\tLang.postLoad();\n\t}\n\n\t/**\n\t * Load any command localizations from the Client's `commandsDir`.\n\t * Called automatically by the YAMDBF Client at startup\n\t * @static\n\t * @method loadCommandLocalizations\n\t * @returns {void}\n\t */\n\tpublic static loadCommandLocalizations(): void\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\n\t\tif (!Lang._instance.client.commandsDir) return;\n\t\tLang.loadCommandLocalizationsFrom(Lang._instance.client.commandsDir);\n\n\t\tconst helpTextLangs: Set<string> = new Set();\n\t\tfor (const command of Object.keys(Lang._instance.commandInfo))\n\t\t\tfor (const lang of Object.keys(Lang._instance.commandInfo[command]))\n\t\t\t\thelpTextLangs.add(lang);\n\n\t\tLang.logger.info('Lang', `Loaded helptext localizations for ${helpTextLangs.size} languages.`);\n\t}\n\n\t/**\n\t * Get localized Command info, defaulting to the info\n\t * given in the Command's constructor\n\t * @static\n\t * @method getCommandInfo\n\t * @param {Command} command Command to get localized info for\n\t * @param {string} lang Language to get the localized info in\n\t * @returns {LocalizedCommandInfo}\n\t */\n\tpublic static getCommandInfo(command: Command, lang: string): LocalizedCommandInfo\n\t{\n\t\tif (!Lang._instance) throw new Error('Lang singleton instance has not been created.');\n\n\t\tif (!command) throw new Error('A Command must be given for which to get Command info.');\n\t\tlet desc: string, info: string, usage: string;\n\t\tif (!Lang._instance.commandInfo[command.name]\n\t\t\t|| (Lang._instance.commandInfo[command.name]\n\t\t\t\t&& !Lang._instance.commandInfo[command.name][lang]))\n\t\t\treturn { desc, info, usage } = command;\n\n\t\tdesc = Lang._instance.commandInfo[command.name][lang].desc || command.desc;\n\t\tinfo = Lang._instance.commandInfo[command.name][lang].info || command.info;\n\t\tusage = Lang._instance.commandInfo[command.name][lang].usage || command.usage;\n\n\t\treturn { desc, info, usage };\n\t}\n\n\t/**\n\t * Get a string resource for the given language, replacing any\n\t * templates with the given data and evaluating any embedded\n\t * template scripts\n\t * @static\n\t * @method res\n\t * @param {string} lang Language to get a string resource for\n\t * @param {string} key String key to get\n\t * @param {TemplateData} [data] Values to replace in the string\n\t * @returns {string}\n\t */\n\tpublic static res(lang: string, key: string, data: TemplateData = {}): string\n\t{\n\t\tif (!Lang.langs[lang]) return `${lang}::${key}`;\n\t\tconst maybeTemplates: RegExp = /^{{ *[a-zA-Z]+ *\\?}}[\\t ]*\\n|{{ *[a-zA-Z]+ *\\?}}/gm;\n\t\tconst scriptTemplate: RegExp = /^{{!([\\s\\S]+)!}}[\\t ]*\\n|{{!([\\s\\S]+)!}}/m;\n\t\tconst strings: { [key: string]: string } = Lang.langs[lang].strings;\n\t\tlet loadedString: string = strings[key];\n\n\t\tif (!loadedString) return `${lang}::${key}`;\n\t\tif (typeof data === 'undefined') return loadedString;\n\n\t\tfor (const template of Object.keys(data))\n\t\t{\n\t\t\t// Skip maybe templates so they can be removed properly later\n\t\t\tif (new RegExp(`{{ *${template} *\\\\?}}`, 'g').test(loadedString)\n\t\t\t\t&& (data[template] === '' || data[template] === undefined)) continue;\n\n\t\t\tloadedString = loadedString.replace(\n\t\t\t\tnew RegExp(`{{ *${template} *\\\\??}}`, 'g'), () => data[template]);\n\t\t}\n\n\t\tconst scriptTemplates: RegExp = new RegExp(scriptTemplate, 'gm');\n\t\tif (scriptTemplates.test(loadedString))\n\t\t{\n\t\t\tconst resourceLoader: ResourceLoader = Lang.createResourceLoader(lang);\n\t\t\tconst res: ResourceLoader =\n\t\t\t\t(stringKey: string, args: TemplateData = data) => resourceLoader(stringKey, args);\n\n\t\t\tfor (const scriptData of loadedString.match(scriptTemplates))\n\t\t\t{\n\t\t\t\tlet functionBody: string =\n\t\t\t\t\tscriptData.match(scriptTemplate)[1] || scriptData.match(scriptTemplate)[2];\n\n\t\t\t\tlet script: Function = new Function('args', 'res', functionBody);\n\n\t\t\t\tlet result: string;\n\t\t\t\ttry { result = script(data, res); }\n\t\t\t\tcatch (err) { throw new Error(`in embedded localization script for: ${lang}::${key}\\n${err}`); }\n\n\t\t\t\t// Try to coerce an implicit return\n\t\t\t\tif (typeof result === 'undefined')\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tfunctionBody = `return ${functionBody.replace(/^[\\s]+/, '')}`;\n\t\t\t\t\t\tscript = new Function('args', 'res', functionBody);\n\t\t\t\t\t\tresult = script(data, res);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (err) {}\n\n\t\t\t\tif (/^{{!([\\s\\S]+)!}}[\\t ]*\\n/.test(scriptData) && result !== '')\n\t\t\t\t\tloadedString = loadedString.replace(scriptData, () => `${result}\\n`);\n\t\t\t\telse loadedString = loadedString.replace(scriptData, () => result);\n\t\t\t}\n\t\t}\n\n\t\treturn loadedString\n\t\t\t.replace(maybeTemplates, '')\n\t\t\t.replace(/\\\\n/g, '\\n');\n\t}\n\n\t/**\n\t * Takes a language string and returns a function that loads string\n\t * resources for that specific language\n\t * @static\n\t * @method createResourceLoader\n\t * @param {string} lang The language to create a loader for\n\t * @returns {ResourceLoader}\n\t */\n\tpublic static createResourceLoader(lang: string): ResourceLoader\n\t{\n\t\treturn (key, data) => Lang.res(lang, key, data);\n\t}\n}\n"],"sourceRoot":"../../src"}